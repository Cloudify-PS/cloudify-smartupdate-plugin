plugins:
  cloudify_smart_update:
    executor: central_deployment_agent
    package_name: cloudify-smartupdate-plugin
    package_version: '1.0'
    source: cloudify-smartupdate-plugin


workflows:
  smart_update:
    mapping: cloudify_smart_update.plugin.workflows.smart_update
    parameters:
      update_id:
        default: ''
      skip_install:
        default: false
      skip_uninstall:
        default: false
      added_instance_ids:
        default: []
      added_target_instances_ids:
        default: []
      removed_instance_ids:
        default: []
      remove_target_instance_ids:
        default: []
      modified_entity_ids:
        default: []
      extended_instance_ids:
        default: []
      extend_target_instance_ids:
        default: []
      reduced_instance_ids:
        default: []
      reduce_target_instance_ids:
        default: []
      ignore_failure:
        default: false
        type: boolean
      install_first:
        default: false
        type: boolean
      node_instances_to_reinstall:
        default: []
      preupdate:
        default: true
      update:
        default: true
      postupdate:
        default: true

node_types:
  cloudify.nodes.SmartRoot:
    derived_from: cloudify.nodes.Root
    interfaces:
      cloudify.interfaces.preupdate:
        stop: cloudify_smart_update.plugin.tasks.get_operation_name
        delete: cloudify_smart_update.plugin.tasks.get_operation_name
      cloudify.interfaces.update:
        update: cloudify_smart_update.plugin.tasks.get_operation_name
      cloudify.interfaces.postupdate:
        create: cloudify_smart_update.plugin.tasks.get_operation_name
        configure: cloudify_smart_update.plugin.tasks.get_operation_name
        start: cloudify_smart_update.plugin.tasks.get_operation_name

  # cloudify.nodes.SmartDeploymentProxy:
  #   derived_from: cloudify.nodes.DeploymentProxy


relationships:
  cloudify.relationships.smart_connected_to:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_preupdate:
        unlink: cloudify_smart_update.plugin.tasks.get_operation_name
      cloudify.interfaces.relationship_update:
        update: cloudify_smart_update.plugin.tasks.get_operation_name
      cloudify.interfaces.relationship_postupdate:
        preconfigure: cloudify_smart_update.plugin.tasks.get_operation_name
        postconfigure: cloudify_smart_update.plugin.tasks.get_operation_name
        establish: cloudify_smart_update.plugin.tasks.get_operation_name
    target_interfaces:
      cloudify.interfaces.relationship_preupdate:
        unlink: cloudify_smart_update.plugin.tasks.get_operation_name
      cloudify.interfaces.relationship_update:
        update: cloudify_smart_update.plugin.tasks.get_operation_name
      cloudify.interfaces.relationship_postupdate:
        preconfigure: cloudify_smart_update.plugin.tasks.get_operation_name
        postconfigure: cloudify_smart_update.plugin.tasks.get_operation_name
        establish: cloudify_smart_update.plugin.tasks.get_operation_name
